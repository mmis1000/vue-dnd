import{z as c,r as S,y as ft,h as q,W,o as F,ae as _,af as Z,I as X,C,H as tt,b as et,c as $,k as pt,j as N,ag as ht,ac as gt}from"./framework-9002dd78.js";const U=Symbol("VUE_DND_KEY"),Y=a=>{const t=c(a),n=Array.isArray(t)?t:[t];for(const o of n)if(it(o))return!0},w=(a,t,n)=>{const o=c(a),i=Array.isArray(o)?o:[o],s=new Set,r=n?c(n.type):[],f=Array.isArray(r)?r:[r];for(const p of f)s.add(p[M]);for(const p of i)if(it(p)&&t!=null&&mt(t,p)||xt(p)&&n&&n.data!=null&&s.has(p[M])&&Et(n.data,p))return!0;return!1},St=(...a)=>{const t=[],n=S(null);for(const i of a)ft(i.ref)||typeof i.ref=="function"?t.push(i.ref):i.ref!=null&&console.error("cannot support other typeof ref currently");let o=null;return t.length>0&&(o=q({set(i){n.value=i,t.forEach(s=>typeof s=="function"?s(i):s.value=i)},get(){return n.value}})),o===null?W(...a):W(...a,{ref:o})},nt=Symbol("native_file"),M=Symbol("typed"),it=a=>a!=null&&a[nt]===!0,mt=(a,t)=>t.accept==null?!0:t.accept(a),xt=a=>a!=null&&typeof a[M]=="symbol",Et=(a,t)=>t.accept==null?!0:typeof t.accept=="function"?t.accept(c(a)):t.accept===c(a),R="NativeEvent",It=-1,st=a=>({[nt]:!0,accept:a,withFilter(t){return st(t)}}),Mt=st(),rt=a=>{const t=Symbol();return{[M]:t,withFilter(n){const o=rt(n);return o[M]=t,o},accept:a}},ot=rt("Default");let yt=0;const vt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z/C/HgAGgwJ/lK3Q6wAAAABJRU5ErkJggg==",V="application/vue-dnd",O=a=>{var n;const t=(n=a.dataTransfer)==null?void 0:n.types.find(o=>o.startsWith(V));return t?t.slice(V.length+1):null},b=(a,t)=>{for(let n=a.length-1;n>=0;n--)t(a[n])&&a.splice(n,1)};class Q{constructor(t,n,o,i,s,r,f,p,h,l){return this.type=t,this.id=n,this.data=o,this.source=i,this.mouseOffset=s,this.mousePosition=r,this.preview=f,this.size=p,this.initialDragEvent=h,this.movingElement=l,this.targetStatus=et([]),this.mappedTargets=q(()=>this.targetStatus.map(m=>m.id)),_(this)}get targets(){return this.mappedTargets.value}}let Dt=class{constructor(){this.currentInstanceId=yt++,this.dragEventIndex=0,this.dropTargetId=0,this.dragTargetId=0,this.executions=_([]),this.emptyImage=null,this.readonlyExecutions=Z(this.executions)}onMounted(){const t=o=>{if(this.executions.length!==0){const r=[o.clientX,o.clientY];for(const f of this.executions)f.mousePosition=r}const i=O(o),s=i!=null?this.executions.find(r=>r.id===i):void 0;s&&s.preview!=null&&(o.defaultPrevented?o.dataTransfer.dropEffect="copy":(o.preventDefault(),o.dataTransfer.dropEffect="move"))},n=o=>{const i=O(o),s=i!=null?this.executions.find(r=>r.id===i):void 0;s&&s.preview!=null&&o.preventDefault()};this.emptyImage=new Image,this.emptyImage.src=vt,document.addEventListener("dragover",t),document.addEventListener("drop",n),X(()=>{document.removeEventListener("dragover",t),document.removeEventListener("drop",n)})}useDraggableDecorator({data:t,type:n=ot,onDragStart:o,preview:i,disabled:s=!1}={}){const r=this.dragTargetId++,f=S(null),p={ref:f},h={draggable:"true",onDragstart:l=>{var g,v;if(c(s))return;const m=this.currentInstanceId+"."+this.dragEventIndex++,e=[l.clientX,l.clientY],u=f.value.getBoundingClientRect(),d=[e[0]-u.left,e[1]-u.top];this.executions.push(new Q(c(n),m,c(t),r,d,e,i,[u.width,u.height],l,l.target)),i==null?(g=l.dataTransfer)==null||g.setDragImage(f.value,...d):(v=l.dataTransfer)==null||v.setDragImage(this.emptyImage,0,0),l.dataTransfer.setData("text/plain",""),l.dataTransfer.setData(V+"-"+m,""),o==null||o(l,c(t))},onDragend:l=>{c(s)||b(this.executions,m=>m.movingElement===l.target)}};return C(()=>c(s),l=>{l&&b(this.executions,m=>m.source===r)}),[r,()=>p,()=>h]}useDroppableDecorator(t){const n=this.dropTargetId++,o={onDrop:i=>{var p;if(c(t.disabled??!1))return;const s=O(i),r=this.executions.find(h=>h.id===s);if(s!=null&&r==null)return;w(t.accept,i,r)&&(i.preventDefault(),b(this.executions,h=>h.id===(s??R)),(p=t.onDrop)==null||p.call(t,i,r?c(r.data):void 0)),Y(t.accept)&&(i.preventDefault(),b(this.executions,h=>h.id===(s??R)))},onDragenter:i=>{var f,p;if(c(t.disabled??!1))return;const s=O(i),r=this.executions.find(h=>h.id===s);if(s==null&&r==null&&Y(t.accept)){let l=this.executions.find(m=>m.id===R);l==null&&(l=new Q([],R,void 0,It,[0,0],[0,0],void 0,[0,0],i,void 0),this.executions.push(l)),l.targetStatus.find(m=>m.id===n)==null&&l.targetStatus.push({id:n,elements:[]}),l.targetStatus.find(m=>m.id===n).elements.push(i.target),w(t.accept,i,r)&&((f=t.onDragEnter)==null||f.call(t,i,c(l.data)));return}r!=null&&(r.targetStatus.find(h=>h.id===n)==null&&r.targetStatus.push({id:n,elements:[]}),r.targetStatus.find(h=>h.id===n).elements.push(i.target),w(t.accept,i,r)&&((p=t.onDragEnter)==null||p.call(t,i,c(r.data))))},onDragleave:i=>{var p,h;if(c(t.disabled??!1))return;const s=O(i),r=this.executions.find(l=>l.id===s);if(s==null&&r==null&&Y(t.accept)){const m=this.executions.find(e=>e.id===R);if(m!=null){const e=m.targetStatus.find(u=>u.id===n);e!=null&&(b(e.elements,u=>u===i.target),e.elements.length===0&&b(m.targetStatus,u=>u===e)),m.targetStatus.length===0&&b(this.executions,u=>u.id===R),w(t.accept,i,r)&&((p=t.onDragLeave)==null||p.call(t,i,c(m.data)));return}}if(r==null)return;const f=r.targetStatus.find(l=>l.id===n);f!=null&&(b(f.elements,l=>l===i.target),f.elements.length===0&&b(r.targetStatus,l=>l===f)),w(t.accept,i,r)&&((h=t.onDragLeave)==null||h.call(t,i,c(r.data)))},onDragover:i=>{var p;if(c(t.disabled??!1))return;const s=O(i),r=this.executions.find(h=>h.id===s);if(s!=null&&r==null)return;w(t.accept,i,r)&&(i.preventDefault(),(p=t.onDragOver)==null||p.call(t,i,r?c(r.data):void 0)),Y(t.accept)&&i.preventDefault()}};return C(()=>c(t.disabled??!1),i=>{i&&this.executions.forEach(s=>{b(s.targetStatus,r=>r.id===n)})}),[n,()=>o]}};const bt=()=>{const a=new Dt;F(()=>{a.onMounted()}),tt(U,a)};let Tt=0;const wt=Object.freeze({minDragDistance:5}),T=(a,t)=>{for(let n=a.length-1;n>=0;n--)t(a[n])&&a.splice(n,1)};class Pt{constructor(t,n,o,i,s,r,f,p,h,l,m,e){return this.type=t,this.id=n,this.data=o,this.source=i,this.mouseOffset=s,this.mousePosition=r,this.preview=f,this.size=p,this.initialEvent=h,this.initialRect=l,this.initialMouse=m,this.elementOffset=e,this.targets=et([]),this.lastEvent=h,_(this)}}let At=class{constructor(t){this.currentInstanceId=Tt++,this.dragEventIndex=0,this.dropTargetId=0,this.dragTargetId=0,this.stagedExecutions=[],this.executions=_([]),this.readonlyExecutions=Z(this.executions),this.draggableElements=new Map,this.droppableElements=new Map,this.droppableDeclarations=new Map,this.droppableDisabled=new Map,this.options=Object.assign({},wt,t??{})}useDraggableDecorator({data:t,type:n=ot,onDragStart:o,preview:i,disabled:s=!1,startDirection:r="all"}={}){const f=this.dragTargetId++,p=S(null),h=S(null);F(()=>{if(!p.value){console.error("[Vue dnd] Cannot get element with ref, did you applied the props to the element?");return}if(!h.value){console.error("[Vue dnd] Cannot get handle element with ref, did you applied the props to the element?");return}this.draggableElements.set(f,p.value)}),X(()=>{this.draggableElements.delete(f)});const l={onPointerdown:e=>{if(c(s))return;const u=[e.clientX,e.clientY],d=this.currentInstanceId+"."+this.dragEventIndex++,g=p.value.getBoundingClientRect(),v=[u[0]-g.left,u[1]-g.top],D=[0,0];T(this.stagedExecutions,I=>I.initialEvent.pointerId===e.pointerId),T(this.executions,I=>I.initialEvent.pointerId===e.pointerId),this.stagedExecutions.push(new Pt(c(n),d,c(t),f,v,u,i,[g.width,g.height],e,g,u,D))},onContextmenu:e=>{if(c(s))return;const u=this.stagedExecutions.find(g=>g.source===f);if(u){this.stagedExecutions.splice(this.stagedExecutions.indexOf(u),1);return}this.executions.find(g=>g.source===f)&&e.preventDefault()},onPointerout:e=>{if(c(s))return;if(this.stagedExecutions.find(d=>d.initialEvent.pointerId===e.pointerId)){T(this.stagedExecutions,d=>d.initialEvent.pointerId===e.pointerId);return}},onPointermove:e=>{var g,v,D,I;if(c(s))return;const u=this.stagedExecutions.find(x=>x.initialEvent.pointerId===e.pointerId);if(u){const x=[e.clientX,e.clientY],P=u.initialMouse,L=((x[0]-P[0])**2+(x[1]-P[1])**2)**.5,H=Math.abs(x[0]-P[0])>Math.abs(x[1]-P[1])?"x":"y";if(L>this.options.minDragDistance&&(c(r)==="all"||c(r)===H)){T(this.stagedExecutions,A=>A.initialEvent.pointerId===e.pointerId),this.executions.push(u);try{h.value.setPointerCapture(e.pointerId)}catch(A){console.warn(A)}o==null||o(e,c(t)),(g=getSelection())==null||g.empty()}return}const d=this.executions.find(x=>x.initialEvent.pointerId===e.pointerId);if(d){d.lastEvent=e;const x=e.target.getBoundingClientRect(),P=[x.left-d.elementOffset[0],x.top-d.elementOffset[1]],L=[P[0]-d.initialRect.left,P[1]-d.initialRect.top],H=[-L[0]+e.clientX-d.initialEvent.clientX,-L[1]+e.clientY-d.initialEvent.clientY];d.elementOffset=H,d.mousePosition=[e.clientX,e.clientY];const A=document.elementFromPoint(e.clientX,e.clientY),B=new Map([...this.droppableElements].map(E=>E.reverse())),at=new Set(B.keys()),k=[];if(A){for(let E=A;E!=null;E=E.parentElement)if(at.has(E)){const y=B.get(E);if(!c(this.droppableDisabled.get(y))){k.push(y);break}}}const z=d.targets,J=k,ct=new Set(z),j=new Set(J),lt=z.filter(E=>!j.has(E)),K=z.filter(E=>j.has(E)),G=J.filter(E=>!ct.has(E));d.targets=[...K,...G];for(const E of K){const y=this.droppableDeclarations.get(E),dt=this.droppableElements.get(E),ut=this.draggableElements.get(d.source);y&&dt!==ut&&((v=y.onDragOver)==null||v.call(y,e,c(d.data)))}for(const E of lt){const y=this.droppableDeclarations.get(E);y&&((D=y.onDragLeave)==null||D.call(y,e,c(d.data)))}for(const E of G){const y=this.droppableDeclarations.get(E);y&&((I=y.onDragEnter)==null||I.call(y,e,c(d.data)))}}},onPointercancel:e=>{if(c(s))return;if(this.stagedExecutions.find(g=>g.initialEvent.pointerId===e.pointerId)){T(this.stagedExecutions,g=>g.initialEvent.pointerId===e.pointerId);return}if(this.executions.find(g=>g.initialEvent.pointerId===e.pointerId)){try{h.value.releasePointerCapture(e.pointerId)}catch(g){console.warn(g)}T(this.executions,g=>g.initialEvent.pointerId===e.pointerId)}},onPointerup:e=>{var g;if(c(s))return;if(this.stagedExecutions.find(v=>v.initialEvent.pointerId===e.pointerId)){T(this.stagedExecutions,v=>v.initialEvent.pointerId===e.pointerId);return}const d=this.executions.find(v=>v.initialEvent.pointerId===e.pointerId);if(d){try{h.value.releasePointerCapture(e.pointerId)}catch(I){console.warn(I)}T(this.executions,I=>I.initialEvent.pointerId===e.pointerId);const D=d.targets.filter(I=>{const x=this.droppableDeclarations.get(I);return x===void 0?!1:w(x.accept,void 0,d)});if(D.length>0){const I=D[D.length-1],x=this.droppableDeclarations.get(I);(g=x==null?void 0:x.onDrop)==null||g.call(x,e,c(t))}}},ref:h},m={ref:p};return C(()=>c(s),e=>{e&&T(this.executions,u=>u.source===f)}),[f,()=>{const e=this.executions.find(g=>g.source===f),u=e!=null,d=u&&i===void 0?{transform:`translate(${e.elementOffset[0]}px, ${e.elementOffset[1]}px)`,pointerEvents:u?"none":""}:{};return{...m,style:d}},()=>{const e=this.executions.find(D=>D.source===f),u=e!=null;let d=!1;if(e!=null&&e.targets.length>0)for(const D of e.targets){const I=this.droppableDeclarations.get(D);I&&w(I.accept,void 0,e)&&(d=!0)}const g=u?{"touch-action":c(r)==="all"?"none":c(r)==="x"?"pan-y":"pan-x","user-select":"none",cursor:d?"move":"no-drop"}:{"touch-action":c(r)==="all"?"none":c(r)==="x"?"pan-y":"pan-x"};return{...l,style:g}}]}useDroppableDecorator(t){const n=this.dropTargetId++,o=S(null);return F(()=>{o.value&&(this.droppableElements.set(n,o.value),this.droppableDeclarations.set(n,t),this.droppableDisabled.set(n,t.disabled??!1))}),X(()=>{this.droppableElements.delete(n),this.droppableDeclarations.delete(n),this.droppableDisabled.delete(n)}),C(()=>c(t.disabled??!1),i=>{i&&this.executions.forEach(s=>{T(s.targets,r=>r===n)})}),[n,()=>({ref:o})]}};const Rt=a=>{tt(U,new At(a))},Yt=$({props:{teleportTo:{type:String,default:"body"}},setup(a,{slots:t}){const n=pt(U);if(n==null)throw new Error("[vue-dnd] DragLayer must be used with a provider");const o={position:"fixed",top:"0",left:"0",right:"0",bottom:"0",overflow:"hidden","pointer-events":"none","z-index":2147483647};return()=>{const i=n.readonlyExecutions.filter(s=>s.preview!==void 0&&s.size!==void 0).map(s=>{const r=s.mousePosition[0]-s.mouseOffset[0],f=s.mousePosition[1]-s.mouseOffset[1],p=s.size,h=[0,0],l={position:"absolute",left:"0px",top:"0px",width:p[0]+"px",height:p[1]+"px",transform:`translate(${r+h[0]}px,${f+h[1]}px)`,"touch-action":"none","will-change":"transform"},m={position:"absolute",left:"0px",top:"0px",bottom:"0px",right:"0px",margin:"0"};return N("div",{style:l,key:s.id},ht(s.preview(),{style:m}))});return a.teleportTo?N(gt,{to:a.teleportTo},N("div",{style:o},i)):N("div",{style:o},i)}}}),Ct=$({setup(a,{slots:t}){return bt(),()=>{var n;return((n=t.default)==null?void 0:n.call(t))??[]}}}),_t=$({setup(a,{slots:t}){return Rt(),()=>{var n;return((n=t.default)==null?void 0:n.call(t))??[]}}});export{Yt as D,Ct as H,Mt as N,_t as P,U as a,w as b,rt as c,St as m};
